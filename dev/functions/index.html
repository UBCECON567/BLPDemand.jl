<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Function Reference · BLPDemand.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">BLPDemand.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../simulation/">Simulations</a></li><li class="is-active"><a class="tocitem" href>Function Reference</a><ul class="internal"><li><a class="tocitem" href="#Index"><span>Index</span></a></li></ul></li><li><a class="tocitem" href="../implementation/">Developer Notes</a></li><li><a class="tocitem" href="../replicateblp/">Replicating BLP</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Function Reference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Function Reference</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/UBCECON567/BLPDemand.jl/blob/master/docs/src/functions.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Function-Reference"><a class="docs-heading-anchor" href="#Function-Reference">Function Reference</a><a id="Function-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#Function-Reference" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.BLPData" href="#BLPDemand.BLPData"><code>BLPDemand.BLPData</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Data set for BLP demand model.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/data.jl#LL35-L37">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.MarketData" href="#BLPDemand.MarketData"><code>BLPDemand.MarketData</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Data from a single market for a BLP demand model</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/data.jl#LL1-L3">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.blpdata-Tuple{AbstractMatrix, AbstractArray{T, 3} where T, AbstractArray{T, 3} where T, AbstractArray{T, 3} where T}" href="#BLPDemand.blpdata-Tuple{AbstractMatrix, AbstractArray{T, 3} where T, AbstractArray{T, 3} where T, AbstractArray{T, 3} where T}"><code>BLPDemand.blpdata</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Constructs data for IV random coefficients logit model from arrays. Compared to <a href="#BLPDemand.MarketData"><code>MarketData</code></a>, each argument should have one more dimension with length <code>T</code>=number of markets</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/data.jl#LL58-L60">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.blpdata-Tuple{AbstractMatrix, Vararg{AbstractArray{T, 3} where T, 5}}" href="#BLPDemand.blpdata-Tuple{AbstractMatrix, Vararg{AbstractArray{T, 3} where T, 5}}"><code>BLPDemand.blpdata</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Constructs data for BLP demand model from arrays. Compared to <a href="#BLPDemand.MarketData"><code>MarketData</code></a>, each argument should have one more dimension with length <code>T</code>=number of markets</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/data.jl#LL40-L42">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.blpdata-Tuple{DataFrames.DataFrame, Symbol, Symbol, Symbol, Vector{Symbol}, Vector{Symbol}, Vector{Symbol}, Vector{Symbol}, AbstractArray{T, 3} where T}" href="#BLPDemand.blpdata-Tuple{DataFrames.DataFrame, Symbol, Symbol, Symbol, Vector{Symbol}, Vector{Symbol}, Vector{Symbol}, Vector{Symbol}, AbstractArray{T, 3} where T}"><code>BLPDemand.blpdata</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">function blpdata(df::AbstractDataFrame,
             mid::Symbol,
             firmid::Symbol,
             s::Symbol,                 
             x::Vector{Symbol},
             w::Vector{Symbol},
             zd::Vector{Symbol},
             zs::Vector{Symbol},
             ν::AbstractArray{T,3} where T)</code></pre><p>Construct BLPData from a DataFrame.</p><p><strong>Arguments</strong></p><ul><li><code>df::AbstractDataFrame</code></li><li><code>mid::Symbol</code> market identifier in <code>df</code></li><li><code>s::Symbol</code> market shares </li><li><code>x::Vector{Symbol}</code> columns of <code>df</code> of product characteristics. <code>x[1]</code> must be price</li><li><code>w::Vector{Symbol}</code> cost shifters</li><li><code>zd::Vector{Symbol}</code> demand instruments</li><li><code>zs::Vector{Symbol}</code> supply instruments</li><li><code>ν::Array{T, 3} where T</code> <code>K × S × T</code> array of draws for Monte Carlo integration</li></ul><p>See also <a href="#BLPDemand.MarketData"><code>MarketData</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/data.jl#LL75-L99">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.data_blp1999-Tuple{}" href="#BLPDemand.data_blp1999-Tuple{}"><code>BLPDemand.data_blp1999</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">function loadblpdata()</code></pre><p>Loads data from Berry, Levinsohn, and Pakes (1999).</p><p>Returns a DataFrame.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/data.jl#LL124-L130">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.delta-Union{Tuple{T}, Tuple{AbstractVector{T}, AbstractMatrix{T}, AbstractMatrix{T}, AbstractVector{T}}} where T" href="#BLPDemand.delta-Union{Tuple{T}, Tuple{AbstractVector{T}, AbstractMatrix{T}, AbstractMatrix{T}, AbstractVector{T}}} where T"><code>BLPDemand.delta</code></a> — <span class="docstring-category">Method</span></header><section><div><p>function delta(s, x, ν, σ;                 tol=sqrt(eps(eltype(s))), maxiter=1000)</p><p>Solves for δ in s = share(δ, ...) using contraction mapping iteration.</p><p>See also: <a href="#BLPDemand.share-Tuple{AbstractVector, AbstractVector, AbstractMatrix, AbstractMatrix}"><code>share</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/share.jl#LL165-L174">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.demandmoments-Tuple{AbstractVector, AbstractVector, Vector{MarketData}}" href="#BLPDemand.demandmoments-Tuple{AbstractVector, AbstractVector, Vector{MarketData}}"><code>BLPDemand.demandmoments</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">demandmoments(β::AbstractVector,σ::AbstractVector,
                       dat::BLPData)</code></pre><p>Demand side moments in BLP model.</p><p><strong>Arguments</strong></p><ul><li><code>β</code> length <code>K</code> (=number characteristics) vector of average tastes for characteristics</li><li><code>σ</code> length <code>K</code> vector of standard deviations of tastes</li><li><code>dat::BLPData</code></li></ul><p>Returns <code>(moments, ξ)</code> where vector of moments is length <code>L</code> with <code>moments[l] = 1/(JT) ∑ⱼ∑ₜ ξ[t][j]*dat[t].zd[l,j]</code></p><p>See also: <a href="#BLPDemand.share-Tuple{AbstractVector, AbstractVector, AbstractMatrix, AbstractMatrix}"><code>share</code></a>, <a href="#BLPDemand.delta-Union{Tuple{T}, Tuple{AbstractVector{T}, AbstractMatrix{T}, AbstractMatrix{T}, AbstractVector{T}}} where T"><code>delta</code></a>, <a href="@ref"><code>simulateRCIVlogit</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/estimation.jl#LL1-L16">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.dsharedp-Tuple{AbstractVector, AbstractVector, AbstractVector, AbstractMatrix, AbstractMatrix, AbstractVector}" href="#BLPDemand.dsharedp-Tuple{AbstractVector, AbstractVector, AbstractVector, AbstractMatrix, AbstractMatrix, AbstractVector}"><code>BLPDemand.dsharedp</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">function dsharedp(β::AbstractVector,
              σ::AbstractVector,
              p::AbstractVector,
              x::AbstractMatrix,
              ν::AbstractMatrix,
              ξ::AbstractVector)</code></pre><p>Compute market shares and their derivatives in BLP random coefficients demand model.</p><p>See <a href="#BLPDemand.sharep-Tuple{AbstractVector, AbstractVector, AbstractVector, AbstractMatrix, AbstractMatrix, AbstractVector}"><code>sharep</code></a> for argument details.</p><p><strong>Returns</strong></p><ul><li><code>s</code> vector <code>J</code> market shares</li><li><code>ds</code> <code>J × J</code> Jacobian matrix with ds[l,j] = ∂s[l]/∂p[j]</li><li><code>Λ</code> <code>J × J</code> diagonal matrix with <code>ds = Λ - Γ</code></li><li><code>Γ</code> <code>J × J</code> matrix </li></ul><p>See <a href="#BLPDemand.eqprices-Tuple{AbstractVector, AbstractVector, AbstractVector, AbstractVector, AbstractMatrix, AbstractMatrix}"><code>eqprices</code></a> for usage of <code>Λ</code> and <code>Γ</code>.    </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/share.jl#LL109-L128">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.eqprices-Tuple{AbstractVector, AbstractVector, AbstractVector, AbstractVector, AbstractMatrix, AbstractMatrix}" href="#BLPDemand.eqprices-Tuple{AbstractVector, AbstractVector, AbstractVector, AbstractVector, AbstractMatrix, AbstractMatrix}"><code>BLPDemand.eqprices</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">function eqprices(mc::AbstractVector,
                  β::AbstractVector, σ::AbstractVector,
                  ξ::AbstractVector,
                  x, ν;
                  firmid= 1:length(mc),
                  tol=sqrt(eps(eltype(mc))),
                  maxiter=10000)</code></pre><p>Compute equilibrium prices in BLP model using ζ contraction method of <a href=" https:/www.jstor.org/stable/23013173">Morrow &amp; Skerlos (2011)</a>.</p><p><strong>Arguments</strong></p><ul><li><code>mc</code> vector of <code>J</code> marginal costs</li><li><code>β</code> vector of <code>K</code> taste coefficients</li><li><code>σ</code> vector of <code>K</code> taste standard deviations</li><li><code>ξ</code> vector of <code>J</code> demand shocks</li><li><code>x</code> <code>(K-1) × J</code> exogenous product characteristics</li><li><code>ν</code> <code>K × S × T</code> array of draws of <code>ν</code></li><li><code>firmid= (1:J)</code> identifier of firm producing each good. Default value assumes each good is produced by a different firm.</li><li><code>tol</code> convergence tolerance</li><li><code>maxiter</code> maximum number of iterations.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/simulate.jl#LL36-L60">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.estimateBLP-Tuple{Vector{MarketData}}" href="#BLPDemand.estimateBLP-Tuple{Vector{MarketData}}"><code>BLPDemand.estimateBLP</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">estimateBLP(dat::BLPData; method=:MPEC, verbose=true, W=I, optimizer=optimizer_with_attributes(Ipopt.Optimizer, start_with_resto=&gt;&quot;no&quot;), supply=true)</code></pre><p>Estimates a random coefficients BLP demand model</p><p><strong>Arguments</strong></p><ul><li><code>dat::BLPData</code></li><li><code>method=:MPEC</code> method for estimation. Available choices are :MPEC, :NFXP, or :GEL.</li><li><code>verbose=true</code> whether to display information about optimization progress</li><li><code>W=I</code> <code>L × L</code> weighting matrix for moments.</li><li><code>max_iter=200</code> number of iterations of optimizer</li><li><code>optimizer=(method==:NFXP ? LBFGS(linesearch=LineSearches.HagerZhang()) :                             optimizer_with_attributes(Ipopt.Optimizer,                                            &quot;max_iter&quot;=&gt; 100,                                            &quot;start_with_resto&quot; =&gt; &quot;no&quot;,                                            &quot;print_level&quot; =&gt; 5*verbose))</code>  optimization method. See below for details.</li><li><code>supply=true</code> whether to include supply side moments</li><li><code>β0=nothing</code> initial value for β. If isnothing, then will set automatically.</li><li><code>σ0=nothing</code> initial value for σ. If isnothing, then will set automatically.</li><li><code>γ0=nothing</code> initial value of γ. If isnothing, then will set automatically.</li></ul><p><strong>Details</strong></p><p>Uses <code>L</code> unconditional moments for estimation. The moments are <code>moments[l] = 1/(T) ∑ₜ∑ⱼ (ξ[t][t]*dat[t].zd[l,j] + ω[t][j]*dat[t].zs[l,j])</code></p><p><strong>Methods</strong></p><ul><li><code>:NFXP</code> nested fixed point GMM. <code>minimize_θ G(δ(θ),θ)&#39;W G(δ(θ),θ)</code></li><li><code>:MPEC</code> constrainted GMM. <code>minimize_{θ,Δ} G(Δ, θ)&#39; W G(Δ, θ) s.t. Δ = δ(θ)</code></li><li><code>:GEL</code> constrained empiricla likelihood  <code>maximize_{p, θ, Δ} ∑ₜ log(p[t]) s.t. E_p[g(Δ, θ)] = 0 and Δ = δ(θ)</code>  For some models, there might be no feasible point for EL. This is  especially likely if the number of moments is large.</li></ul><p><code>supply=false</code> should give the same results as <a href="#BLPDemand.estimateRCIVlogit-Tuple{Vector{MarketData}}"><code>estimateRCIVlogit</code></a>. However, with <code>method=:MPEC</code> or <code>:GEL</code>, the formulation of the JuMP model differs, and so might the results. Generally, <a href="#BLPDemand.estimateRCIVlogit-Tuple{Vector{MarketData}}"><code>estimateRCIVlogit</code></a> is faster for data with a small number of products, but scales very poorly as the number of products increases. See <a href="https://ubcecon567.github.io/BLPDemand.jl/dev/implementation/">the developer notes</a> for more information.</p><p><strong>Optimizers</strong></p><p>If <code>method=:NFXP</code>, optimizer should be an unconstrained optimizer from the Optim.jl package. The default of <code>LBFGS()</code> is usually a good choice. <code>BFGS()</code> instead of <code>LBFGS()</code> and/or changing linesearch to <code>LineSearches.BackTracking()</code> are also worth trying.</p><p>If <code>method=:MPEC</code> or <code>:GEL</code>, the optimizer must be comptible with JuMP and capable of solving nonliner problems. The default, <code>Ipopt</code>, will occassionally fail. If <code>verbose</code> is <code>true</code> and you repeatedly see warning messages from Ipopt, then it is likely that Ipopt will run for many iterations and eventually fail to converge. Changing Ipopt&#39;s <code>start_with_reso</code> option sometimes helps. For problems of the size seen in the docs or tests, when Ipopt succeeds, it generally does so in 100 or fewer iterations. Ipopt has many additional options, see <a href="https://coin-or.github.io/Ipopt/OPTIONS.html">the Ipopt documentation</a> for a complete list.</p><p>See also: <a href="#BLPDemand.optimalIV-Tuple{Any, Any, Any, Vector{MarketData}}"><code>optimalIV</code></a>, <a href="#BLPDemand.varianceBLP-Tuple{Any, Any, Any, Vector{MarketData}}"><code>varianceBLP</code></a>, <a href="#BLPDemand.simulateBLP-Tuple{Any, Any, AbstractVector, AbstractVector, AbstractVector, Any}"><code>simulateBLP</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/estimation.jl#LL425-L490">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.estimateRCIVlogit-Tuple{Vector{MarketData}}" href="#BLPDemand.estimateRCIVlogit-Tuple{Vector{MarketData}}"><code>BLPDemand.estimateRCIVlogit</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">estimateRCIVlogit(dat::BLPData; method=:MPEC, verbose=true, W=I)</code></pre><p>Estimates a random coefficients IV logit model.</p><p><strong>Arguments</strong></p><ul><li><code>dat::BLPData</code></li><li><code>method=:MPEC</code> method for estimation. Available choices are :MPEC, :NFXP, or :GEL</li><li><code>verbose=true</code> whether to display information about optimization progress</li><li><code>W=I</code> weighting matrix</li><li><code>max_iter</code> optimizer iteration limit</li><li><code>optimizer</code> see <a href="#BLPDemand.estimateBLP-Tuple{Vector{MarketData}}"><code>estimateBLP</code></a> for details</li><li><code>β0=nothing</code> initial value for β. If isnothing, then will try to automatically set</li><li><code>σ0=nothing</code> initial value for σ. If isnothing, then will try to automatically set</li></ul><p>Note that methods <code>:MPEC</code> and <code>:GEL</code> use a large amount of memory when the number of products is large. Either <code>method=:NFXP</code> or <a href="#BLPDemand.estimateBLP-Tuple{Vector{MarketData}}"><code>estimateBLP</code></a> with <code>supply=false</code> should be used if the number of products is large.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/estimation.jl#LL224-L243">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.fracRCIVlogit-Tuple{Vector{MarketData}}" href="#BLPDemand.fracRCIVlogit-Tuple{Vector{MarketData}}"><code>BLPDemand.fracRCIVlogit</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">fracRCIVlogit(dat::BLPData)</code></pre><p>Estimate random coefficients IV model using &quot;Fast, Robust, Approximately Correct&quot; method of Salanie &amp; Wolak (2019)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/estimation.jl#LL898-L902">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.makeivblp-Tuple{AbstractMatrix}" href="#BLPDemand.makeivblp-Tuple{AbstractMatrix}"><code>BLPDemand.makeivblp</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">makeivblp(x::AbstractMatrix, firmid=1:size(x,2))</code></pre><p>Function for constructing demand instrumental variables following BLP (1995).</p><p>Instruments consist of exogenous product characteristics, sum of rivals exogenous characteristics, and, if there are any multi-product firms, sum of characteristics of other goods produced by the same firm.</p><p>If includeexp is true, then also use <code>sum(exp(-([x[2:end,j,t] - x[l,j,t])^2) for l in 1:J))</code> as instruments.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/estimation.jl#LL117-L130">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.makeivblp-Tuple{Vector{MarketData}}" href="#BLPDemand.makeivblp-Tuple{Vector{MarketData}}"><code>BLPDemand.makeivblp</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">makeivblp(dat::BLPData; includeexp=true)</code></pre><p>Sets dat[:].zd and dat[:].zs to makeivblp([x[2:end,:] w])</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/estimation.jl#LL172-L176">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.optimalIV-Tuple{Any, Any, Any, Vector{MarketData}}" href="#BLPDemand.optimalIV-Tuple{Any, Any, Any, Vector{MarketData}}"><code>BLPDemand.optimalIV</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">optimalIV(β, σ, γ, dat::BLPData ; degree=2)</code></pre><p>Computes optimal instruments for BLP model. Given initial estimates θ=(<code>β</code>, <code>σ</code>, <code>γ</code>), computes <code>e(θ)ⱼₜ = (ξ(θ)ⱼₜ , ω(θ)ⱼₜ)</code>, and then approximates the optimal instruments with a polynomial regression of <code>degree</code> of <code>∂e/∂θ</code> on <code>z</code>. Returns BLPData with instruments set to fitted values <code>(zd, zs) = (E[∂ξ/∂θ|z], E[∂ω/∂θ|z])</code></p><p><strong>Notes</strong></p><ul><li>This function has not be carefully tested and should be considered experimental.</li><li>This code assumes homoskedasticity to construct the optimal iv, E[ee&#39;|z] = E[ee&#39;]</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/estimation.jl#LL850-L862">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.polyreg-Tuple{AbstractMatrix, AbstractMatrix, AbstractMatrix}" href="#BLPDemand.polyreg-Tuple{AbstractMatrix, AbstractMatrix, AbstractMatrix}"><code>BLPDemand.polyreg</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">  polyreg(xpred::AbstractMatrix,
          xdata::AbstractMatrix,
          ydata::AbstractMatrix; degree=1)</code></pre><p>Computes  polynomial regression of ydata on xdata. Returns predicted y at x=xpred.</p><p><strong>Arguments</strong></p><ul><li><code>xpred</code> x values to compute fitted y</li><li><code>xdata</code> observed x</li><li><code>ydata</code> observed y, must have <code>size(y)[1] == size(xdata)[1]</code></li><li><code>degree</code></li><li><code>deriv</code> whether to also return df(xpred). Only implemented when  xdata is one dimentional</li></ul><p><strong>Returns</strong></p><ul><li>Estimates of <code>f(xpred)</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/estimation.jl#LL788-L808">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.share-Tuple{AbstractVector, AbstractVector, AbstractMatrix, AbstractMatrix}" href="#BLPDemand.share-Tuple{AbstractVector, AbstractVector, AbstractMatrix, AbstractMatrix}"><code>BLPDemand.share</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">function share(δ::AbstractVector, σ::AbstractVector, x::AbstractMatrix, ν::AbstractMatrix)</code></pre><p>Compute market shares in BLP random coefficients demand model.</p><p>Market shares are given by </p><p class="math-container">\[ s_{j} = \int \frac{e^{\delta_j + x_j σ ν}}{1+\sum_{i=1}^J e^{\delta_i + x_i σ ν}} dF_ν(ν)\]</p><p><strong>Arguments:</strong></p><ul><li><code>δ</code> vector of length <code>J=</code> number of products</li><li><code>σ</code> vector of length <code>K=</code> number of characteristics</li><li><code>x</code> <code>K × J</code> matrix of product characteristics</li><li><code>ν</code> <code>K × S</code> matrix of simulation draws for integration</li></ul><p>Returns vector of length <code>J</code> market shares. </p><p>See also: <a href="#BLPDemand.delta-Union{Tuple{T}, Tuple{AbstractVector{T}, AbstractMatrix{T}, AbstractMatrix{T}, AbstractVector{T}}} where T"><code>delta</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/share.jl#LL2-L22">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.sharep-Tuple{AbstractVector, AbstractVector, AbstractVector, AbstractMatrix, AbstractMatrix, AbstractVector}" href="#BLPDemand.sharep-Tuple{AbstractVector, AbstractVector, AbstractVector, AbstractMatrix, AbstractMatrix, AbstractVector}"><code>BLPDemand.sharep</code></a> — <span class="docstring-category">Method</span></header><section><div><p>function sharep(β::AbstractVector,                    σ::AbstractVector,                    p::AbstractVector,                    x::AbstractMatrix,                    ν::AbstractMatrix,                    ξ::AbstractVector)</p><p>Compute market shares in BLP random coefficients demand model.</p><p>Market shares are given by </p><p class="math-container">\[ s_{j} = \int \frac{e^{\delta_j + x_j σ ν}}{1+\sum_{i=1}^J e^{\delta_i + x_i σ ν}} dF_ν(ν)\]</p><p>where </p><p class="math-container">\[\delta_j = β[1]*p[j] + x[:,j]&#39; *β[2:end] + ξ[j]\]</p><p><strong>Arguments:</strong></p><ul><li><code>β</code> vector of length <code>K=</code> number of characteristics</li><li><code>σ</code> vector of length <code>K=</code> number of characteristics</li><li><code>p</code> <code>J</code> vector of prices</li><li><code>x</code> <code>(K-1) × J</code> matrix of exogenous product characteristics</li><li><code>ν</code> <code>K × S</code> matrix of simulation draws for integration</li><li><code>ξ</code> <code>J</code> vector of demand shocks</li></ul><p>Returns vector of length <code>J</code> market shares. </p><p>See also: <a href="@ref"><code>share</code>, <code>dsharedp</code></a>  </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/share.jl#LL51-L82">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.simulateBLP-Tuple{Any, Any, AbstractVector, AbstractVector, AbstractVector, Any}" href="#BLPDemand.simulateBLP-Tuple{Any, Any, AbstractVector, AbstractVector, AbstractVector, Any}"><code>BLPDemand.simulateBLP</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">function simulateBLP(J, T, β, σ, γ, S; varξ=1, varω=1, randj=1.0, firmid=1:J, costf=:log)</code></pre><p>Simulates a BLP demand and supply model.</p><p><strong>Arguments</strong></p><ul><li><code>J</code> numebr of products</li><li><code>T::Integer</code> number of markets</li><li><code>β::AbstractVector</code> with <code>length(β)=K</code>, average tastes for characteristics. The first characteristic will be endogeneous (price)</li><li><code>σ::AbstractVector</code> with <code>length(σ)=K</code>, standard deviation of tastes for characteristics</li><li><code>γ::AbstractVector</code> marginal cost coefficients</li><li><code>S</code> number of simulation draws to calculate market shares</li><li><code>varξ=1</code> variance of ξ</li><li><code>varω=1</code> variance of ω</li><li><code>randj=1.0</code> if less than 1, then J is the maximum number of products per market. Each product is included in each market with probability randj</li><li><code>firmid=1:J</code> firm identifiers. Must be length J.</li></ul><p><strong>Returns</strong></p><ul><li><code>dat</code> a <a href="#BLPDemand.BLPData"><code>BLPData</code></a> struct</li><li><code>ξ</code></li><li><code>ω</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/simulate.jl#LL93-L115">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.simulateIVRClogit-NTuple{6, Any}" href="#BLPDemand.simulateIVRClogit-NTuple{6, Any}"><code>BLPDemand.simulateIVRClogit</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">function simulateIVRClogit(T, β, σ, π, ρ, S)</code></pre><p>Simulates a random coefficients logit model with endogeneity.</p><p><strong>Arguments</strong></p><ul><li><code>T::Integer</code> number of markets</li><li><code>β::AbstractVector</code> with <code>length(β)=K</code>, average tastes for characteristics.</li><li><code>σ::AbstractVector</code> with <code>length(σ)=K</code>, standard deviation of tastes for characteristics</li><li><code>π::AbstractMatrix</code> with <code>size(π) = (L, K, J)</code>, first stage coefficients</li><li><code>ρ::Number</code> strength of endogeneity</li><li><code>S</code> number of simulation draws to calculate market shares</li></ul><p>Returns <a href="#BLPDemand.BLPData"><code>BLPData</code></a> struct</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/simulate.jl#LL1-L16">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.supplymoments-Tuple{AbstractVector, AbstractVector, AbstractVector, AbstractVector, Vector{MarketData}}" href="#BLPDemand.supplymoments-Tuple{AbstractVector, AbstractVector, AbstractVector, AbstractVector, Vector{MarketData}}"><code>BLPDemand.supplymoments</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">supplymoments(γ::AbstractVector, β::AbstractVector, σ::AbstractVector,
                   ξ::AbstractVector, dat::BLPData)</code></pre><p>Supply side moments in a BLP model. Assumes that marginal cost is <code>costf</code> linear,</p><p class="math-container">\[costf(c_{jt}) = w_{jt}&#39;γ + ω_{jt}\]</p><p>and prices are Bertrand-Nash</p><p class="math-container">\[c_{t} = p_{t} + (∂s/∂p)^{-1} s\]</p><p>where <code>∂s/∂p</code> is the Jacobian of shares with respect to prices, but with the <code>j,l</code> entry set to zero unless goods <code>j</code> and <code>l</code> are produced by the same firm.</p><p><strong>Arguments</strong></p><ul><li><code>γ</code> marginal cost coefficients</li><li><code>β</code> length <code>K</code> (=number characteristics) vector of average tastes for characteristics</li><li><code>σ</code> length <code>K</code> vector of standard deviations of tastes</li><li><code>ξ</code> <code>J × T</code> matrix of market demand shocks</li><li><code>dat::BLPData</code></li></ul><p>Returns <code>(moments, ω)</code> an <code>L</code> vector of moments with <code>moments[l] = 1/(T) ∑ₜ∑ⱼ ω[t][j]*dat[t].zs[l,j]</code></p><p><strong>Notes:</strong></p><p>May encounter numeric problems if <code>costf</code> has a limited domain. In particular, for some values of parameters, we may have</p><p class="math-container">\[p_{t} + (∂s/∂p)^{-1} s &lt; 0\]</p><p>in which case the implied marginal cost is negative.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/estimation.jl#LL44-L77">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.tran-Tuple{Any}" href="#BLPDemand.tran-Tuple{Any}"><code>BLPDemand.tran</code></a> — <span class="docstring-category">Method</span></header><section><div><p>pack(β::AbstractVector, σ::AbstractVector, ...)</p><p>Packs parameters into a single vector, θ.</p><p>Returns tuple with the packed parameters, θ, and a function to unpack them, i.e.</p><pre><code class="nohighlight hljs">unpack(θ) = (β, σ, ...)</code></pre><p>and</p><pre><code class="nohighlight hljs">pack(unpack(θ)) = θ</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/estimation.jl#LL189-L202">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.varianceBLP-Tuple{Any, Any, Any, Vector{MarketData}}" href="#BLPDemand.varianceBLP-Tuple{Any, Any, Any, Vector{MarketData}}"><code>BLPDemand.varianceBLP</code></a> — <span class="docstring-category">Method</span></header><section><div><p>varianceBLP(β, σ, γ, dat::BLPData ; W=I)</p><p>Computes variance of BLP estimates. Computes moment variance clustering on <code>t</code>.</p><p>Returns <code>Σ</code> = covariance of <code>[β, σ, γ]</code> and <code>varm</code> = (clustered) covariance of moments.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/estimation.jl#LL750-L756">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="BLPDemand.varianceRCIVlogit-Tuple{Any, Any, Vector{MarketData}}" href="#BLPDemand.varianceRCIVlogit-Tuple{Any, Any, Vector{MarketData}}"><code>BLPDemand.varianceRCIVlogit</code></a> — <span class="docstring-category">Method</span></header><section><div><p>varianceRCIVlogit(β, σ, dat::BLPData ; W=I)</p><p>Computes variance of RCIVlogit estimates. Computes moment variance clustering on <code>t</code>.</p><p>Returns <code>Σ</code> = covariance of <code>[β, σ, γ]</code> and <code>varm</code> = (clustered) covariance of moments.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/UBCECON567/BLPDemand.jl/blob/73a978d38d03076135d27bdc6d9c066fe7348f19/src/estimation.jl#LL719-L725">source</a></section></article><h2 id="Index"><a class="docs-heading-anchor" href="#Index">Index</a><a id="Index-1"></a><a class="docs-heading-anchor-permalink" href="#Index" title="Permalink"></a></h2><ul><li><a href="#BLPDemand.BLPData"><code>BLPDemand.BLPData</code></a></li><li><a href="#BLPDemand.MarketData"><code>BLPDemand.MarketData</code></a></li><li><a href="#BLPDemand.blpdata-Tuple{AbstractMatrix, Vararg{AbstractArray{T, 3} where T, 5}}"><code>BLPDemand.blpdata</code></a></li><li><a href="#BLPDemand.blpdata-Tuple{AbstractMatrix, AbstractArray{T, 3} where T, AbstractArray{T, 3} where T, AbstractArray{T, 3} where T}"><code>BLPDemand.blpdata</code></a></li><li><a href="#BLPDemand.blpdata-Tuple{DataFrames.DataFrame, Symbol, Symbol, Symbol, Vector{Symbol}, Vector{Symbol}, Vector{Symbol}, Vector{Symbol}, AbstractArray{T, 3} where T}"><code>BLPDemand.blpdata</code></a></li><li><a href="#BLPDemand.data_blp1999-Tuple{}"><code>BLPDemand.data_blp1999</code></a></li><li><a href="#BLPDemand.delta-Union{Tuple{T}, Tuple{AbstractVector{T}, AbstractMatrix{T}, AbstractMatrix{T}, AbstractVector{T}}} where T"><code>BLPDemand.delta</code></a></li><li><a href="#BLPDemand.demandmoments-Tuple{AbstractVector, AbstractVector, Vector{MarketData}}"><code>BLPDemand.demandmoments</code></a></li><li><a href="#BLPDemand.dsharedp-Tuple{AbstractVector, AbstractVector, AbstractVector, AbstractMatrix, AbstractMatrix, AbstractVector}"><code>BLPDemand.dsharedp</code></a></li><li><a href="#BLPDemand.eqprices-Tuple{AbstractVector, AbstractVector, AbstractVector, AbstractVector, AbstractMatrix, AbstractMatrix}"><code>BLPDemand.eqprices</code></a></li><li><a href="#BLPDemand.estimateBLP-Tuple{Vector{MarketData}}"><code>BLPDemand.estimateBLP</code></a></li><li><a href="#BLPDemand.estimateRCIVlogit-Tuple{Vector{MarketData}}"><code>BLPDemand.estimateRCIVlogit</code></a></li><li><a href="#BLPDemand.fracRCIVlogit-Tuple{Vector{MarketData}}"><code>BLPDemand.fracRCIVlogit</code></a></li><li><a href="#BLPDemand.makeivblp-Tuple{Vector{MarketData}}"><code>BLPDemand.makeivblp</code></a></li><li><a href="#BLPDemand.makeivblp-Tuple{AbstractMatrix}"><code>BLPDemand.makeivblp</code></a></li><li><a href="#BLPDemand.optimalIV-Tuple{Any, Any, Any, Vector{MarketData}}"><code>BLPDemand.optimalIV</code></a></li><li><a href="#BLPDemand.polyreg-Tuple{AbstractMatrix, AbstractMatrix, AbstractMatrix}"><code>BLPDemand.polyreg</code></a></li><li><a href="#BLPDemand.share-Tuple{AbstractVector, AbstractVector, AbstractMatrix, AbstractMatrix}"><code>BLPDemand.share</code></a></li><li><a href="#BLPDemand.sharep-Tuple{AbstractVector, AbstractVector, AbstractVector, AbstractMatrix, AbstractMatrix, AbstractVector}"><code>BLPDemand.sharep</code></a></li><li><a href="#BLPDemand.simulateBLP-Tuple{Any, Any, AbstractVector, AbstractVector, AbstractVector, Any}"><code>BLPDemand.simulateBLP</code></a></li><li><a href="#BLPDemand.simulateIVRClogit-NTuple{6, Any}"><code>BLPDemand.simulateIVRClogit</code></a></li><li><a href="#BLPDemand.supplymoments-Tuple{AbstractVector, AbstractVector, AbstractVector, AbstractVector, Vector{MarketData}}"><code>BLPDemand.supplymoments</code></a></li><li><a href="#BLPDemand.tran-Tuple{Any}"><code>BLPDemand.tran</code></a></li><li><a href="#BLPDemand.varianceBLP-Tuple{Any, Any, Any, Vector{MarketData}}"><code>BLPDemand.varianceBLP</code></a></li><li><a href="#BLPDemand.varianceRCIVlogit-Tuple{Any, Any, Vector{MarketData}}"><code>BLPDemand.varianceRCIVlogit</code></a></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../simulation/">« Simulations</a><a class="docs-footer-nextpage" href="../implementation/">Developer Notes »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Thursday 11 May 2023 19:29">Thursday 11 May 2023</span>. Using Julia version 1.9.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
